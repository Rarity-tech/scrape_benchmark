name: Debug API Response

on:
  workflow_dispatch:
    inputs:
      room_id:
        description: 'Room ID √† tester'
        required: true
        type: string
        default: '1568035193532843456'

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: Install dependencies
        run: |
          pip install pyairbnb==2.1.1 curl_cffi
      
      - name: Debug API response
        env:
          ROOM_ID: ${{ inputs.room_id }}
        run: |
          python << 'EOF'
          import os
          import json
          import pyairbnb

          ROOM_ID = os.environ.get("ROOM_ID", "1568035193532843456")

          print("=" * 80)
          print(f"üîç DEBUG: pyairbnb.get_details() pour room_id={ROOM_ID}")
          print("=" * 80)

          try:
              details = pyairbnb.get_details(
                  room_id=ROOM_ID,
                  currency="AED",
                  proxy_url="",
                  language="en",
              )
              
              if details:
                  print(f"\n‚úÖ Donn√©es re√ßues!")
                  print(f"\nüìã TYPE: {type(details)}")
                  
                  if isinstance(details, dict):
                      print(f"\nüìã TOUTES LES CL√âS ({len(details)} cl√©s):")
                      print("-" * 40)
                      for key in sorted(details.keys()):
                          value = details[key]
                          value_type = type(value).__name__
                          if isinstance(value, (str, int, float, bool)):
                              preview = str(value)[:100]
                              print(f"  {key}: {preview} ({value_type})")
                          elif isinstance(value, dict):
                              print(f"  {key}: {{...}} ({len(value)} cl√©s: {list(value.keys())[:5]})")
                          elif isinstance(value, list):
                              print(f"  {key}: [...] ({len(value)} √©l√©ments)")
                          else:
                              print(f"  {key}: {value_type}")
                      
                      # Afficher le contenu de "rating" si existe
                      if "rating" in details:
                          print(f"\nüìä CONTENU DE details['rating']:")
                          print("-" * 40)
                          print(json.dumps(details["rating"], indent=2, default=str))
                      
                      # Afficher le contenu de "host" si existe
                      if "host" in details:
                          print(f"\nüë§ CONTENU DE details['host']:")
                          print("-" * 40)
                          print(json.dumps(details["host"], indent=2, default=str))
                      
                      # Afficher highlights si existe
                      if "highlights" in details:
                          print(f"\nüèÜ CONTENU DE details['highlights']:")
                          print("-" * 40)
                          print(json.dumps(details["highlights"], indent=2, default=str))
                      
                      # Chercher is_super_host et is_guest_favorite
                      print(f"\nüîç BADGES:")
                      print("-" * 40)
                      print(f"  is_super_host: {details.get('is_super_host', 'NON TROUV√â')}")
                      print(f"  is_superhost: {details.get('is_superhost', 'NON TROUV√â')}")
                      print(f"  is_guest_favorite: {details.get('is_guest_favorite', 'NON TROUV√â')}")
                      
                      # Afficher le JSON complet (tronqu√©)
                      print(f"\nüìÑ JSON COMPLET (premiers 8000 chars):")
                      print("-" * 40)
                      full_json = json.dumps(details, indent=2, default=str)
                      print(full_json[:8000])
                      if len(full_json) > 8000:
                          print(f"\n... (tronqu√©, total: {len(full_json)} chars)")
                  else:
                      print(f"Donn√©es brutes: {details}")
              else:
                  print("‚ùå Aucune donn√©e retourn√©e (None)")
                  
          except Exception as e:
              print(f"‚ùå Erreur: {e}")
              import traceback
              traceback.print_exc()
          EOF
