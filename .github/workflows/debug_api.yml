name: Debug PyAirbnb Details

on:
  workflow_dispatch:
    inputs:
      room_id:
        description: 'Room ID to test'
        required: true
        default: '1149961985722988324'

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: Install dependencies
        run: pip install pyairbnb
      
      - name: Debug get_details structure
        env:
          ROOM_ID: ${{ inputs.room_id }}
        run: |
          python << 'EOF'
          import os
          import json
          import pyairbnb

          ROOM_ID = os.environ.get("ROOM_ID", "1149961985722988324")

          print("=" * 60)
          print(f"üîç DEBUG pyairbnb.get_details() pour Room {ROOM_ID}")
          print("=" * 60)

          try:
              details = pyairbnb.get_details(
                  room_id=ROOM_ID,
                  currency="AED",
                  proxy_url="",
                  language="en",
              )
              
              print(f"\n‚úÖ Succ√®s! Type: {type(details)}")
              
              if isinstance(details, dict):
                  print(f"\nüìÇ TOUTES LES CL√âS ({len(details)} cl√©s):")
                  for key in sorted(details.keys()):
                      val = details[key]
                      if val is None:
                          print(f"   {key}: None")
                      elif isinstance(val, dict):
                          print(f"   {key}: {{dict with {len(val)} keys}}")
                      elif isinstance(val, list):
                          print(f"   {key}: [list with {len(val)} items]")
                      elif isinstance(val, str) and len(val) > 50:
                          print(f"   {key}: '{val[:50]}...'")
                      else:
                          print(f"   {key}: {val}")
                  
                  print("\n" + "-" * 40)
                  print("üè† INFOS LOGEMENT RECHERCH√âES:")
                  print(f"   room_type: {details.get('room_type')}")
                  print(f"   bedrooms: {details.get('bedrooms')}")
                  print(f"   beds: {details.get('beds')}")
                  print(f"   bathrooms: {details.get('bathrooms')}")
                  print(f"   person_capacity: {details.get('person_capacity')}")
                  
                  # Chercher des variantes
                  print("\nüîé RECHERCHE DE VARIANTES:")
                  for key in details.keys():
                      key_lower = key.lower()
                      if any(word in key_lower for word in ['bed', 'bath', 'room', 'capacity', 'guest', 'person', 'sleep']):
                          print(f"   {key}: {details[key]}")
                  
                  # Afficher le JSON complet (tronqu√©)
                  print("\nüìÑ JSON COMPLET (tronqu√©):")
                  print(json.dumps(details, indent=2, default=str)[:3000])
              else:
                  print(f"\n‚ö†Ô∏è R√©ponse inattendue: {details}")
                  
          except Exception as e:
              print(f"\n‚ùå Erreur: {e}")
              import traceback
              traceback.print_exc()

          print("\n" + "=" * 60)
          print("üéâ FIN DU DEBUG")
          print("=" * 60)
          EOF
